groups:
  - name: network-alerts
    rules:
      # Device down (ICMP probe fails)
      - alert: DeviceDown
        expr: probe_success{job="icmp-probes"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Device {{ $labels.instance }} is down"
          description: "ICMP probe to {{ $labels.instance }} has been failing for over 2 minutes."

      # HTTP endpoint down
      - alert: HTTPEndpointDown
        expr: probe_success{job="http-probes"} == 0
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "HTTP endpoint {{ $labels.instance }} is down"
          description: "HTTP probe to {{ $labels.instance }} has been failing for over 2 minutes."

      # SNMP target unreachable
      - alert: SNMPTargetUnreachable
        expr: up{job="mikrotik-snmp"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "SNMP target {{ $labels.instance }} unreachable"
          description: "Cannot reach SNMP target {{ $labels.instance }} for over 2 minutes."

  - name: host-alerts
    rules:
      # High CPU usage on workstation
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage on {{ $labels.instance }}"
          description: "CPU usage is above 85% for over 5 minutes (current: {{ $value }}%)."

      # High memory usage
      - alert: HighMemoryUsage
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 90
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage on {{ $labels.instance }}"
          description: "Memory usage is above 90% for over 5 minutes (current: {{ $value }}%)."

      # Disk space low
      - alert: DiskSpaceLow
        expr: (1 - (node_filesystem_avail_bytes{fstype!~"tmpfs|overlay"} / node_filesystem_size_bytes{fstype!~"tmpfs|overlay"})) * 100 > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Disk space low on {{ $labels.instance }}"
          description: "Disk usage on {{ $labels.mountpoint }} is above 85% (current: {{ $value }}%)."

  - name: interface-alerts
    rules:
      # Interface down
      - alert: InterfaceDown
        expr: ifOperStatus == 2
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Interface down on {{ $labels.instance }}"
          description: "Interface index {{ $labels.ifIndex }} is operationally down."

      # High interface errors
      - alert: HighInterfaceErrors
        expr: rate(ifInErrors[5m]) > 1 or rate(ifOutErrors[5m]) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High interface errors on {{ $labels.instance }}"
          description: "Interface errors detected on {{ $labels.instance }} ifIndex {{ $labels.ifIndex }}."
